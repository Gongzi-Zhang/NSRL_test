#!/usr/bin/env python3
# coding: utf-8

import sys
from utilities import *
from parser import Parser

def usage():
    print(sys.argv[0] + ' -l run_list.txt [-p prefix] [-d output_dir] ')
    print('\t-h: print this help message')
    print('\t-l: input list file')
    print('\t-p: output prefix (the output will be prefix_hist.root and prefix_mip.json)')
    print('\t-d: output dir (the output root and json files will be stored in this dir.')

if __name__ == '__main__':
    # read in command line arguments
    i=1
    listFile = ''
    outPrefix = 'out'
    outDir = '.'
    while i<len(sys.argv):
        if '-h' == sys.argv[i]:
            usage()
            exit(0)
        elif '-l' == sys.argv[i]:
            listFile = sys.argv[i+1]
            i += 1
        elif '-p' == sys.argv[i]:
            outPrefix = sys.argv[i+1]
            i += 1
        elif '-d' == sys.argv[i]:
            outDir = sys.argv[i+1]
            i += 1
        else:
            logger.error(f'Unknown argument {sys.argv[i]}')
            exit(1)
        i += 1

    parser = Parser(listFile, outPrefix, outDir, "mip")                                                   
    parser.parse()                                                                                       
    parser.fit_mip()    
    parser.write()
